# Quartz Digital Garden with Traefik & Authelia

This repository contains the configuration to deploy a secure, self-hosted Quartz digital garden using Docker. The setup is designed for a Raspberry Pi or any Linux-based home server.

It uses **Traefik** as a reverse proxy, **Authelia** for secure authentication, and **Nginx** to serve the static site generated by Quartz. A dedicated builder container automatically syncs notes from a local vault and rebuilds the site daily. User secrets are managed locally and are ignored by Git for security.

---

## 🚀 Technology Stack

* **Docker & Docker Compose:** For containerizing all services.
* **Quartz:** The static site generator that turns an Obsidian vault into a website.
* **Traefik:** A modern reverse proxy that routes traffic to the correct services.
* **Authelia:** An authentication portal that protects the digital garden with a login page.
* **Nginx:** A lightweight web server to serve the static HTML files generated by Quartz.
* **Cron:** Used within a container to schedule daily site rebuilds.

---

## 📁 Required Directory Structure

For this setup to work, the following directory structure must be created on the host machine. This repository should be cloned into the `homelab/setups/quartz` directory.

```
/home/pi/
├── homelab/
│   └── setups/
│       └── quartz/
│           ├── .gitignore              # (This repository)
│           ├── docker-compose.yml      # (This repository)
│           └── authelia/
│               ├── configuration.yml
│               └── users_database.yml.example #<-- Secrets template
│
├── notes/                          #<-- YOUR OBSIDIAN VAULT (Must be created)
│
└── services/
    └── quartz/                     #<-- The Quartz project source (Must be created)
```

---

## ⚙️ Setup on a Fresh Machine

Follow these steps to deploy the entire stack from scratch.

### 1. Prerequisites

Ensure the new machine has the following installed:
* `git`
* `docker`
* `docker-compose`

### 2. Clone This Repository

Clone this repository to the correct location:

```bash
git clone http://github.com/vasujain275/homelab ~/homelab
```

### 3. Create Service and Notes Directories

These directories are not part of the Git repository and must be created manually.

```bash
mkdir -p /home/pi/notes
mkdir -p /home/pi/services
```
**Important:** Place your entire Obsidian vault inside `/home/pi/notes`.

### 4. Clone the Quartz Source Code

The builder service needs the Quartz project files to generate the site. Clone it into the `/home/pi/services/` directory.

```bash
cd /home/pi/services/
git clone https://github.com/jackyzha0/quartz.git
```

### 5. Configure Authelia

Navigate to the configuration directory: `cd /home/pi/homelab/setups/quartz/`

**a. Create your secrets file:**
Copy the example file to create your local, un-versioned secrets file.
```bash
cp authelia/users_database.yml.example authelia/users_database.yml
```

**b. Set your user password:**
Edit the **new** `authelia/users_database.yml` file. Generate a secure password hash by running the following command and replacing `'your_password'` with a strong password.
```bash
docker run authelia/authelia:latest authelia hash-password 'your_password'
```
Copy the entire output (starting with `$argon2id$...`) and paste it as the `password` value in `users_database.yml`.

**c. Set the session secret:**
Edit `authelia/configuration.yml` and replace the placeholder value for `session.secret`. You can generate a new one with:
```bash
openssl rand -hex 32
```

### 6. Edit Your `hosts` File

On your **main computer** (not the Pi), you need to map the local domains to your Pi's IP address. This lets your browser know where to find `garden.local`.

* **On macOS/Linux:** Edit `/etc/hosts`
* **On Windows:** Edit `C:\Windows\System32\drivers\etc\hosts`

Add the following line, replacing `<your-pi-ip-address>` with the actual IP address of your Raspberry Pi:
```
<your-pi-ip-address> garden.local auth.garden.local
```

### 7. Launch the Stack

Finally, navigate to the directory containing the `docker-compose.yml` file and start all the services.

```bash
cd /home/pi/homelab/setups/quartz/
docker-compose up -d
```
The first launch will take a few minutes as it downloads all the Docker images, installs `npm` dependencies, and performs the initial site build.

---

## 🌐 How to Access

Once the setup is complete, you can access your digital garden and the Traefik dashboard from your main computer's web browser.

* **Digital Garden:**
    * URL: **`http://garden.local:9111`**
    * You will be redirected to the Authelia login page first. Use the credentials you configured in `users_database.yml`.

* **Traefik Dashboard (for debugging):**
    * URL: **`http://<your-pi-ip-address>:8081`**

---

## 🔄 Maintenance

* **Automatic Rebuilds:** The `quartz-builder` service is scheduled to automatically sync your vault from `/home/pi/notes` and rebuild the site **every day at 2:00 AM**.
* **Forcing a Manual Rebuild:** If you want to see changes immediately, you can force a rebuild by restarting the builder service:
    ```bash
    cd /home/pi/homelab/setups/quartz/
    docker-compose restart quartz-builder
    ```
