# Quartz Digital Garden with Traefik & Authelia

This repository contains the configuration to deploy a secure, self-hosted Quartz digital garden using Docker. The setup is designed for a Raspberry Pi or any Linux-based home server.

This version is configured for **direct IP address access**, meaning you do not need to configure local domain names or edit a `hosts` file.

User secrets are managed locally and are ignored by Git for security.

---

## ğŸš€ Technology Stack

* **Docker & Docker Compose:** For containerizing all services.
* **Quartz:** The static site generator that turns an Obsidian vault into a website.
* **Traefik (Reverse Proxy):** **This is the essential gatekeeper.** It intercepts all incoming traffic and forces it to be authenticated by Authelia before allowing access to the website.
* **Authelia (Forward Auth):** An authentication portal that provides the login page and tells Traefik if a user is allowed. It **cannot** protect a service by itself; it requires a reverse proxy.
* **Nginx:** A lightweight web server to serve the static HTML files generated by Quartz.
* **Cron:** Used within a container to schedule daily site rebuilds.

---

## ğŸ“ Required Directory Structure

For this setup to work, the following directory structure must be created on the host machine. This repository (`homelab`) should be cloned directly into `/home/pi/`.

```
/home/pi/
â”œâ”€â”€ homelab/                          # (This repository)
â”‚   â””â”€â”€ setups/
â”‚       â””â”€â”€ quartz/
â”‚           â”œâ”€â”€ .gitignore
â”‚           â”œâ”€â”€ docker-compose.yml
â”‚           â””â”€â”€ authelia/
â”‚               â”œâ”€â”€ configuration.yml.example
â”‚               â””â”€â”€ users_database.yml.example
â”‚
â”œâ”€â”€ notes/                          #<-- YOUR OBSIDIAN VAULT (Must be created)
â”‚
â””â”€â”€ services/
    â””â”€â”€ quartz/                     #<-- The Quartz project source (Must be created)
```

---

## âš™ï¸ Setup on a Fresh Machine

Follow these steps to deploy the entire stack from scratch.

### 1. Prerequisites

Ensure the new machine has the following installed:
* `git`
* `docker`
* `docker-compose`

### 2. Clone Your Homelab Repository

Clone your repository, which contains this setup, into your home directory.

```bash
cd /home/pi/
git clone http://github.com/vasujain275/homelab.git
```

### 3. Create Service and Notes Directories

These directories are not part of the Git repository and must be created manually.

```bash
mkdir -p /home/pi/notes
mkdir -p /home/pi/services
```
**Important:** Place your entire Obsidian vault inside `/home/pi/notes`.

### 4. Clone the Quartz Source Code

The builder service needs the Quartz project files to generate the site. Clone it into the `/home/pi/services/` directory.

```bash
cd /home/pi/services/
git clone https://github.com/jackyzha0/quartz.git
```

### 5. Configure Authelia

Navigate to the configuration directory: `cd /home/pi/homelab/setups/quartz/`

**a. Create your local configuration files:**
Copy the example templates to create your real, un-versioned config files.
```bash
cp authelia/configuration.yml.example authelia/configuration.yml
cp authelia/users_database.yml.example authelia/users_database.yml
```

**b. Set the session secret:**
Edit the **new** `authelia/configuration.yml` file. Find the `session.secret` line and replace the placeholder value. You can generate a strong, random secret with this command:
```bash
openssl rand -hex 32
```

**c. Set your user password:**
Edit the **new** `authelia/users_database.yml` file. Generate a secure password hash by running the following command, replacing `"YOUR_PASSWORD_HERE"` with your desired password.
```bash
docker run authelia/authelia:latest authelia crypto hash generate argon2 --password "YOUR_PASSWORD_HERE"
```
Copy the entire output (starting with `$argon2id$...`) and paste it as the `password` value in `users_database.yml`.

### 6. Launch the Stack

Finally, navigate to the directory containing the `docker-compose.yml` file and start all the services.

```bash
cd /home/pi/homelab/setups/quartz/
docker-compose up -d
```
The first launch will take a few minutes as it downloads all the Docker images, installs `npm` dependencies, and performs the initial site build.

---

## ğŸŒ How to Access

Once the setup is complete, you can access your digital garden by navigating directly to your Raspberry Pi's IP address and the specified port.

* **Digital Garden:**
    * URL: **`http://<your-pi-ip-address>:9111`**
    * When you first visit, you will be shown the Authelia login page. After you log in, you will be redirected to your digital garden.

* **Traefik Dashboard (for debugging):**
    * URL: **`http://<your-pi-ip-address>:8081`**

---

## ğŸ”„ Maintenance

* **Automatic Rebuilds:** The `quartz-builder` service is scheduled to automatically sync your vault from `/home/pi/notes` and rebuild the site **every day at 2:00 AM**.
* **Forcing a Manual Rebuild:** If you want to see changes immediately, you can force a rebuild by restarting the builder service:
    ```bash
    cd /home/pi/homelab/setups/quartz/
    docker-compose restart quartz-builder
    ```
